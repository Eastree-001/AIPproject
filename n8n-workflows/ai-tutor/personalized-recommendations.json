{
  "name": "ä¸ªæ€§åŒ–æ¨èå·¥ä½œæµ",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "GET",
        "path": "api/ai/recommendations/={{ $parameter.userId }}",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "recommendations-webhook",
      "name": "ä¸ªæ€§åŒ–æ¨èè§¦å‘å™¨",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [280, 400],
      "webhookId": "personalized-recommendations"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "user-id",
              "name": "userId",
              "value": "={{ $('ä¸ªæ€§åŒ–æ¨èè§¦å‘å™¨').item.json.params.userId }}",
              "type": "string"
            },
            {
              "id": "recommendation-type",
              "name": "recommendationType",
              "value": "={{ $('ä¸ªæ€§åŒ–æ¨èè§¦å‘å™¨').item.json.query.type || 'courses' }}",
              "type": "string"
            },
            {
              "id": "limit",
              "name": "limit",
              "value": "={{ parseInt($('ä¸ªæ€§åŒ–æ¨èè§¦å‘å™¨').item.json.query.limit) || 5 }}",
              "type": "number"
            },
            {
              "id": "category",
              "name": "category",
              "value": "={{ $('ä¸ªæ€§åŒ–æ¨èè§¦å‘å™¨').item.json.query.category || '' }}",
              "type": "string"
            },
            {
              "id": "difficulty",
              "name": "difficulty",
              "value": "={{ $('ä¸ªæ€§åŒ–æ¨èè§¦å‘å™¨').item.json.query.difficulty || '' }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "extract-parameters",
      "name": "æå–è¯·æ±‚å‚æ•°",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [500, 400]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "user-id-valid",
              "leftValue": "={{ $json.userId }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty"
              }
            },
            {
              "id": "type-valid",
              "leftValue": "={{ $json.recommendationType }}",
              "rightValue": "courses,topics,resources,learning_paths",
              "operator": {
                "type": "string",
                "operation": "contains"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "validate-parameters",
      "name": "éªŒè¯è¯·æ±‚å‚æ•°",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [720, 400]
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "user_progress"
      },
      "id": "get-user-progress",
      "name": "è·å–ç”¨æˆ·è¿›åº¦",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [940, 260],
      "credentials": {
        "supabaseApi": {
          "id": "supabase-credentials",
          "name": "Supabase API"
        }
      }
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "courses"
      },
      "id": "get-available-courses",
      "name": "è·å–å¯ç”¨è¯¾ç¨‹",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [940, 400],
      "credentials": {
        "supabaseApi": {
          "id": "supabase-credentials",
          "name": "Supabase API"
        }
      }
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "users"
      },
      "id": "get-user-profile",
      "name": "è·å–ç”¨æˆ·èµ„æ–™",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [940, 540],
      "credentials": {
        "supabaseApi": {
          "id": "supabase-credentials",
          "name": "Supabase API"
        }
      }
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "ai_sessions"
      },
      "id": "get-recent-interactions",
      "name": "è·å–æœ€è¿‘äº¤äº’",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [940, 680],
      "credentials": {
        "supabaseApi": {
          "id": "supabase-credentials",
          "name": "Supabase API"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const params = $('æå–è¯·æ±‚å‚æ•°').first().json;\nconst userProgress = $('è·å–ç”¨æˆ·è¿›åº¦').first()?.json || [];\nconst availableCourses = $('è·å–å¯ç”¨è¯¾ç¨‹').first()?.json || [];\nconst userProfile = $('è·å–ç”¨æˆ·èµ„æ–™').first()?.json?.[0] || {};\nconst recentInteractions = $('è·å–æœ€è¿‘äº¤äº’').first()?.json || [];\n\n// åˆ†æç”¨æˆ·å­¦ä¹ åå¥½\nconst completedLessons = userProgress.filter(p => p.progress === 100);\nconst inProgressLessons = userProgress.filter(p => p.progress > 0 && p.progress < 100);\n\n// è·å–å·²å®Œæˆå’Œè¿›è¡Œä¸­çš„è¯¾ç¨‹ID\nconst completedCourseIds = [...new Set(completedLessons.map(p => p.course_id))];\nconst inProgressCourseIds = [...new Set(inProgressLessons.map(p => p.course_id))];\nconst allEngagedCourseIds = [...new Set([...completedCourseIds, ...inProgressCourseIds])];\n\n// åˆ†æå­¦ä¹ åå¥½ï¼ˆåŸºäºå·²å‚ä¸çš„è¯¾ç¨‹ï¼‰\nconst engagedCourses = availableCourses.filter(course => allEngagedCourseIds.includes(course.id));\nconst preferredCategories = [...new Set(engagedCourses.map(course => course.category).filter(cat => cat))];\nconst preferredDifficulties = [...new Set(engagedCourses.map(course => course.difficulty).filter(diff => diff))];\nconst mostCommonDifficulty = preferredDifficulties.length > 0 ? preferredDifficulties[0] : 'beginner';\n\n// è¿‡æ»¤æ¨èå€™é€‰è¯¾ç¨‹ï¼ˆæ’é™¤å·²å®Œæˆçš„è¯¾ç¨‹ï¼‰\nlet candidateCourses = availableCourses.filter(course => !completedCourseIds.includes(course.id));\n\n// æ ¹æ®å‚æ•°è¿‡æ»¤\nif (params.category) {\n  candidateCourses = candidateCourses.filter(course => course.category === params.category);\n}\nif (params.difficulty) {\n  candidateCourses = candidateCourses.filter(course => course.difficulty === params.difficulty);\n}\n\n// åˆ†æç”¨æˆ·æœ€è¿‘å…³æ³¨çš„è¯é¢˜\nconst recentTopics = recentInteractions.map(interaction => interaction.topic).slice(0, 5);\n\n// è®¡ç®—å­¦ä¹ ç»Ÿè®¡\nconst totalLessons = userProgress.length;\nconst averageProgress = totalLessons > 0 ? \n  Math.round(userProgress.reduce((sum, p) => sum + p.progress, 0) / totalLessons) : 0;\nconst completionRate = totalLessons > 0 ? Math.round((completedLessons.length / totalLessons) * 100) : 0;\n\n// æ„å»ºæ¨èåˆ†ææç¤ºè¯\nconst recommendationPrompt = `\nä½œä¸ºä¸“ä¸šçš„ä¸ªæ€§åŒ–å­¦ä¹ æ¨èç³»ç»Ÿï¼Œè¯·ä¸ºç”¨æˆ·æä¾›ç²¾å‡†çš„å­¦ä¹ æ¨èã€‚\n\n## ç”¨æˆ·å­¦ä¹ ç”»åƒåˆ†æï¼š\n\n### ğŸ‘¤ åŸºæœ¬ä¿¡æ¯\n- ç”¨æˆ·è§’è‰²ï¼š${userProfile.role || 'student'}\n- ç”¨æˆ·å§“åï¼š${userProfile.name || 'å­¦ä¹ è€…'}\n- å­¦ä¹ ç»å†ï¼š${totalLessons}ä¸ªå­¦ä¹ å•å…ƒ\n\n### ğŸ“Š å­¦ä¹ è¡¨ç°\n- æ€»å­¦ä¹ è¿›åº¦ï¼š${averageProgress}%\n- å®Œæˆç‡ï¼š${completionRate}%\n- å·²å®Œæˆè¯¾ç¨‹ï¼š${completedCourseIds.length}é—¨\n- è¿›è¡Œä¸­è¯¾ç¨‹ï¼š${inProgressCourseIds.length}é—¨\n\n### ğŸ¯ å­¦ä¹ åå¥½åˆ†æ\n- åå¥½è¯¾ç¨‹ç±»åˆ«ï¼š${preferredCategories.join('ã€') || 'æš‚æ— æ˜ç¡®åå¥½'}\n- é€‚åˆéš¾åº¦çº§åˆ«ï¼š${mostCommonDifficulty}\n- æœ€è¿‘å…³æ³¨è¯é¢˜ï¼š${recentTopics.join('ã€') || 'æ— ç‰¹å®šå…³æ³¨ç‚¹'}\n\n### ğŸ“š æ¨èå€™é€‰æ± \n- æ¨èç±»å‹ï¼š${params.recommendationType}\n- å¯æ¨èè¯¾ç¨‹æ•°é‡ï¼š${candidateCourses.length}é—¨\n- è¯·æ±‚æ¨èæ•°é‡ï¼š${params.limit}ä¸ª\n\n### ğŸ“ å¯é€‰è¯¾ç¨‹åˆ—è¡¨ï¼ˆ${candidateCourses.slice(0, 15).length}é—¨ç¤ºä¾‹ï¼‰ï¼š\n${candidateCourses.slice(0, 15).map((course, index) => \n  `${index + 1}. ${course.title} \n   - éš¾åº¦ï¼š${course.difficulty || 'æœªæ ‡è®°'} \n   - ç±»åˆ«ï¼š${course.category || 'é€šç”¨'}\n   - æ—¶é•¿ï¼š${course.duration ? Math.round(course.duration / 60) + 'å°æ—¶' : 'æœªçŸ¥'}\n   - æè¿°ï¼š${course.description ? course.description.substring(0, 60) + '...' : 'æš‚æ— æè¿°'}`\n).join('\\n\\n')}\n\n## è¯·åŸºäºä»¥ä¸Šç”¨æˆ·ç”»åƒæä¾›ä¸ªæ€§åŒ–æ¨èï¼š\n\n### æ¨èè¦æ±‚ï¼š\n1. **ç›¸å…³æ€§**ï¼šæ ¹æ®ç”¨æˆ·çš„å­¦ä¹ å†å²å’Œåå¥½è¿›è¡Œæ¨è\n2. **éš¾åº¦é€‚é…**ï¼šæ¨èéš¾åº¦åº”è¯¥å¾ªåºæ¸è¿›ï¼Œé€‚åˆç”¨æˆ·å½“å‰æ°´å¹³\n3. **å¤šæ ·æ€§**ï¼šæ¨èå†…å®¹åº”è¯¥æœ‰ä¸€å®šçš„å¤šæ ·æ€§ï¼Œé¿å…è¿‡äºå•ä¸€\n4. **å®ç”¨æ€§**ï¼šé‡ç‚¹æ¨èå¯¹ç”¨æˆ·æŠ€èƒ½æå‡æœ‰å®é™…å¸®åŠ©çš„å†…å®¹\n5. **è¿ç»­æ€§**ï¼šè€ƒè™‘ç”¨æˆ·çš„å­¦ä¹ è·¯å¾„ï¼Œæ¨èæœ‰é€»è¾‘å…³è”çš„è¯¾ç¨‹\n\nè¯·ç”¨JSONæ ¼å¼å›ç­”ï¼Œç»“æ„å¦‚ä¸‹ï¼š\n{\n  \"recommendations\": [\n    {\n      \"title\": \"æ¨èé¡¹ç›®æ ‡é¢˜\",\n      \"type\": \"è¯¾ç¨‹ç±»å‹\",\n      \"reason\": \"æ¨èç†ç”±ï¼ˆç»“åˆç”¨æˆ·ç”»åƒï¼‰\",\n      \"benefits\": \"é¢„æœŸå­¦ä¹ æ”¶ç›Š\",\n      \"difficulty\": \"éš¾åº¦çº§åˆ«\",\n      \"estimatedTime\": \"é¢„è®¡å­¦ä¹ æ—¶é•¿\",\n      \"category\": \"è¯¾ç¨‹ç±»åˆ«\",\n      \"prerequisites\": \"å‰ç½®è¦æ±‚\",\n      \"nextSteps\": \"åç»­å­¦ä¹ å»ºè®®\",\n      \"matchScore\": 85\n    }\n  ],\n  \"summary\": \"æ•´ä½“æ¨èè¯´æ˜å’Œå­¦ä¹ è·¯å¾„å»ºè®®\",\n  \"learningPathSuggestion\": \"åŸºäºæ¨èå†…å®¹çš„å­¦ä¹ è·¯å¾„è§„åˆ’\",\n  \"alternativeOptions\": \"å…¶ä»–å¯è€ƒè™‘çš„å­¦ä¹ æ–¹å‘\"\n}\n`;\n\nreturn {\n  userId: params.userId,\n  recommendationType: params.recommendationType,\n  limit: params.limit,\n  userProfile: {\n    role: userProfile.role,\n    name: userProfile.name,\n    totalLessons,\n    averageProgress,\n    completionRate,\n    completedCourses: completedCourseIds.length,\n    inProgressCourses: inProgressCourseIds.length,\n    preferredCategories,\n    mostCommonDifficulty,\n    recentTopics: recentTopics.length\n  },\n  candidateCount: candidateCourses.length,\n  prompt: recommendationPrompt,\n  timestamp: new Date().toISOString()\n};"
      },
      "id": "analyze-user-preferences",
      "name": "åˆ†æç”¨æˆ·åå¥½",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1160, 420]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.coze.cn/open_api/v2/chat",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "httpHeaderAuth",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer {{ $vars.COZE_API_KEY }}"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "contentType": "json",
        "body": {
          "conversation_id": "={{ 'recommendations_' + $json.userId + '_' + Date.now() }}",
          "bot_id": "{{ $vars.COZE_BOT_ID }}",
          "user": "={{ $json.userId }}",
          "query": "={{ 'è¯·ä¸ºæˆ‘æ¨è' + $json.limit + 'ä¸ª' + $json.recommendationType }}",
          "chat_history": [
            {
              "role": "system",
              "content": "={{ $json.prompt }}"
            }
          ],
          "stream": false
        },
        "options": {}
      },
      "id": "call-coze-recommendations",
      "name": "è°ƒç”¨Cozeæ¨è",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1380, 420],
      "credentials": {
        "httpHeaderAuth": {
          "id": "coze-api-credentials",
          "name": "Coze API Auth"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const response = $input.first().json;\nconst analysisData = $('åˆ†æç”¨æˆ·åå¥½').first().json;\n\nlet recommendations = [];\nlet summary = '';\nlet learningPathSuggestion = '';\nlet alternativeOptions = '';\nlet success = false;\n\n// è§£æCoze APIå“åº”\nif (response && response.code === 0 && response.data) {\n  if (response.data.messages && Array.isArray(response.data.messages)) {\n    const assistantMessages = response.data.messages.filter(msg => \n      msg.type === 'answer' || msg.role === 'assistant'\n    );\n    \n    if (assistantMessages.length > 0) {\n      const lastMessage = assistantMessages[assistantMessages.length - 1];\n      const content = lastMessage.content || lastMessage.text || '';\n      \n      try {\n        // å°è¯•è§£æJSONæ ¼å¼çš„æ¨èç»“æœ\n        const jsonMatch = content.match(/\\{[\\s\\S]*\\}/);\n        if (jsonMatch) {\n          const parsedRecommendations = JSON.parse(jsonMatch[0]);\n          recommendations = parsedRecommendations.recommendations || [];\n          summary = parsedRecommendations.summary || '';\n          learningPathSuggestion = parsedRecommendations.learningPathSuggestion || '';\n          alternativeOptions = parsedRecommendations.alternativeOptions || '';\n          success = true;\n        } else {\n          // å¦‚æœä¸æ˜¯JSONæ ¼å¼ï¼Œå°è¯•ç»“æ„åŒ–è§£æ\n          summary = content;\n          success = true;\n        }\n      } catch (parseError) {\n        // JSONè§£æå¤±è´¥ï¼Œä½¿ç”¨åŸå§‹å†…å®¹ä½œä¸ºæ‘˜è¦\n        summary = content;\n        success = true;\n      }\n    }\n  }\n}\n\n// å¦‚æœAIæ¨èå¤±è´¥æˆ–ä¸ºç©ºï¼Œæä¾›åŸºäºç”¨æˆ·æ•°æ®çš„é»˜è®¤æ¨è\nif (!success || recommendations.length === 0) {\n  const profile = analysisData.userProfile;\n  \n  // æ ¹æ®ç”¨æˆ·å®Œæˆç‡å’Œåå¥½ç”Ÿæˆé»˜è®¤æ¨è\n  if (profile.completionRate >= 80) {\n    recommendations = [\n      {\n        title: \"è¿›é˜¶æŠ€èƒ½è¯¾ç¨‹\",\n        type: \"course\",\n        reason: `åŸºäºæ‚¨${profile.completionRate}%çš„ä¼˜ç§€å®Œæˆç‡ï¼Œå»ºè®®å­¦ä¹ æ›´å…·æŒ‘æˆ˜æ€§çš„å†…å®¹`,\n        benefits: \"æå‡ä¸“ä¸šæŠ€èƒ½ï¼Œè·å¾—æ›´é«˜å±‚æ¬¡çš„çŸ¥è¯†æŒæ¡\",\n        difficulty: \"intermediate\",\n        estimatedTime: \"6-8å‘¨\",\n        category: profile.preferredCategories[0] || \"æŠ€èƒ½æå‡\",\n        prerequisites: \"å·²å®ŒæˆåŸºç¡€è¯¾ç¨‹å­¦ä¹ \",\n        nextSteps: \"è€ƒè™‘ä¸“ä¸šè®¤è¯æˆ–å®è·µé¡¹ç›®\",\n        matchScore: 90\n      },\n      {\n        title: \"é¡¹ç›®å®æˆ˜è®­ç»ƒ\",\n        type: \"project\",\n        reason: \"æ‚¨çš„å­¦ä¹ åŸºç¡€æ‰å®ï¼Œé€‚åˆé€šè¿‡å®é™…é¡¹ç›®å·©å›ºçŸ¥è¯†\",\n        benefits: \"å°†ç†è®ºçŸ¥è¯†è½¬åŒ–ä¸ºå®é™…æŠ€èƒ½ï¼Œå¢å¼ºå®æˆ˜ç»éªŒ\",\n        difficulty: \"intermediate\",\n        estimatedTime: \"4-6å‘¨\",\n        category: \"å®è·µåº”ç”¨\",\n        prerequisites: \"ç›¸å…³ç†è®ºåŸºç¡€\",\n        nextSteps: \"æ·±å…¥ä¸“ä¸šé¢†åŸŸå­¦ä¹ \",\n        matchScore: 85\n      }\n    ];\n  } else if (profile.completionRate >= 50) {\n    recommendations = [\n      {\n        title: \"å·©å›ºåŸºç¡€è¯¾ç¨‹\",\n        type: \"course\",\n        reason: `æ‚¨çš„å®Œæˆç‡ä¸º${profile.completionRate}%ï¼Œå»ºè®®å…ˆå·©å›ºå·²å­¦å†…å®¹\",\n        benefits: \"åŠ å¼ºåŸºç¡€çŸ¥è¯†ç†è§£ï¼Œæé«˜å­¦ä¹ æ•ˆç‡\",\n        difficulty: \"beginner\",\n        estimatedTime: \"3-4å‘¨\",\n        category: profile.preferredCategories[0] || \"åŸºç¡€å¼ºåŒ–\",\n        prerequisites: \"æ— ç‰¹æ®Šè¦æ±‚\",\n        nextSteps: \"é€æ­¥æå‡åˆ°ä¸­çº§æ°´å¹³\",\n        matchScore: 75\n      }\n    ];\n  } else {\n    recommendations = [\n      {\n        title: \"å­¦ä¹ æ–¹æ³•ä¼˜åŒ–è¯¾ç¨‹\",\n        type: \"methodology\",\n        reason: \"å»ºè®®å…ˆæå‡å­¦ä¹ æ–¹æ³•å’Œæ•ˆç‡\",\n        benefits: \"æŒæ¡é«˜æ•ˆå­¦ä¹ æŠ€å·§ï¼Œæé«˜å­¦ä¹ æˆæœ\",\n        difficulty: \"beginner\",\n        estimatedTime: \"2-3å‘¨\",\n        category: \"å­¦ä¹ æŠ€èƒ½\",\n        prerequisites: \"æ— \",\n        nextSteps: \"å»ºç«‹ç³»ç»ŸåŒ–å­¦ä¹ ä¹ æƒ¯\",\n        matchScore: 80\n      }\n    ];\n  }\n  \n  summary = `åŸºäºæ‚¨çš„å­¦ä¹ è¡¨ç°ï¼ˆå®Œæˆç‡${profile.completionRate}%ï¼‰ï¼Œæˆ‘ä»¬ä¸ºæ‚¨æ¨èäº†${recommendations.length}ä¸ªé€‚åˆçš„å­¦ä¹ å†…å®¹ã€‚`;\n  learningPathSuggestion = \"å»ºè®®æŒ‰ç…§éš¾åº¦é€’è¿›çš„æ–¹å¼è¿›è¡Œå­¦ä¹ ï¼Œæ¯å®Œæˆä¸€ä¸ªé˜¶æ®µåå†è¿›å…¥ä¸‹ä¸€ä¸ªã€‚\";\n  alternativeOptions = \"æ‚¨ä¹Ÿå¯ä»¥è€ƒè™‘å‚ä¸å­¦ä¹ å°ç»„æˆ–å¯»æ‰¾å­¦ä¹ ä¼™ä¼´ï¼Œé€šè¿‡åä½œå­¦ä¹ æå‡æ•ˆæœã€‚\";\n}\n\n// é™åˆ¶æ¨èæ•°é‡\nrecommendations = recommendations.slice(0, analysisData.limit);\n\nreturn {\n  success: true,\n  data: {\n    userId: analysisData.userId,\n    recommendationType: analysisData.recommendationType,\n    requestedLimit: analysisData.limit,\n    actualCount: recommendations.length,\n    userProfile: analysisData.userProfile,\n    recommendations: recommendations,\n    summary: summary,\n    learningPathSuggestion: learningPathSuggestion,\n    alternativeOptions: alternativeOptions,\n    timestamp: new Date().toISOString()\n  },\n  metadata: {\n    aiResponseSuccess: success,\n    candidateCount: analysisData.candidateCount,\n    generatedAt: new Date().toISOString()\n  }\n};"
      },
      "id": "process-recommendations",
      "name": "å¤„ç†æ¨èç»“æœ",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1600, 420]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ $json.data }}",
        "options": {}
      },
      "id": "return-recommendations",
      "name": "è¿”å›æ¨èç»“æœ",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [1820, 420]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": {
          "success": false,
          "error": "å‚æ•°éªŒè¯å¤±è´¥ï¼šç”¨æˆ·IDä¸èƒ½ä¸ºç©ºï¼Œæ¨èç±»å‹å¿…é¡»æ˜¯coursesã€topicsã€resourcesæˆ–learning_pathsä¹‹ä¸€",
          "timestamp": "={{ new Date().toISOString() }}"
        },
        "responseCode": 400,
        "options": {}
      },
      "id": "validation-error",
      "name": "å‚æ•°éªŒè¯é”™è¯¯",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [940, 600]
    },
    {
      "parameters": {
        "jsCode": "const error = $input.first().error;\nconst params = $('æå–è¯·æ±‚å‚æ•°').first()?.json || {};\n\nreturn {\n  success: false,\n  error: 'ç”Ÿæˆä¸ªæ€§åŒ–æ¨èæ—¶å‘ç”Ÿé”™è¯¯ï¼š' + (error.message || 'æœªçŸ¥é”™è¯¯'),\n  userId: params.userId || null,\n  recommendationType: params.recommendationType || null,\n  timestamp: new Date().toISOString(),\n  details: {\n    errorType: error.name || 'UnknownError',\n    errorMessage: error.message || 'æœªçŸ¥é”™è¯¯'\n  }\n};"
      },
      "id": "error-handler",
      "name": "é”™è¯¯å¤„ç†",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1600, 620]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ $json }}",
        "responseCode": 500,
        "options": {}
      },
      "id": "error-response",
      "name": "é”™è¯¯å“åº”",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [1820, 620]
    }
  ],
  "connections": {
    "ä¸ªæ€§åŒ–æ¨èè§¦å‘å™¨": {
      "main": [
        [
          {
            "node": "æå–è¯·æ±‚å‚æ•°",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "æå–è¯·æ±‚å‚æ•°": {
      "main": [
        [
          {
            "node": "éªŒè¯è¯·æ±‚å‚æ•°",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "éªŒè¯è¯·æ±‚å‚æ•°": {
      "main": [
        [
          {
            "node": "è·å–ç”¨æˆ·è¿›åº¦",
            "type": "main",
            "index": 0
          },
          {
            "node": "è·å–å¯ç”¨è¯¾ç¨‹",
            "type": "main",
            "index": 0
          },
          {
            "node": "è·å–ç”¨æˆ·èµ„æ–™",
            "type": "main",
            "index": 0
          },
          {
            "node": "è·å–æœ€è¿‘äº¤äº’",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "å‚æ•°éªŒè¯é”™è¯¯",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "è·å–ç”¨æˆ·è¿›åº¦": {
      "main": [
        [
          {
            "node": "åˆ†æç”¨æˆ·åå¥½",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "è·å–å¯ç”¨è¯¾ç¨‹": {
      "main": [
        [
          {
            "node": "åˆ†æç”¨æˆ·åå¥½",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "è·å–ç”¨æˆ·èµ„æ–™": {
      "main": [
        [
          {
            "node": "åˆ†æç”¨æˆ·åå¥½",
            "type": "main",
            "index": 2
          }
        ]
      ]
    },
    "è·å–æœ€è¿‘äº¤äº’": {
      "main": [
        [
          {
            "node": "åˆ†æç”¨æˆ·åå¥½",
            "type": "main",
            "index": 3
          }
        ]
      ]
    },
    "åˆ†æç”¨æˆ·åå¥½": {
      "main": [
        [
          {
            "node": "è°ƒç”¨Cozeæ¨è",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "è°ƒç”¨Cozeæ¨è": {
      "main": [
        [
          {
            "node": "å¤„ç†æ¨èç»“æœ",
            "type": "main",
            "index": 0
          }
        ]
      ],
      "error": [
        [
          {
            "node": "é”™è¯¯å¤„ç†",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "å¤„ç†æ¨èç»“æœ": {
      "main": [
        [
          {
            "node": "è¿”å›æ¨èç»“æœ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "é”™è¯¯å¤„ç†": {
      "main": [
        [
          {
            "node": "é”™è¯¯å“åº”",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "2.0.0",
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "id": "personalized-recommendations-workflow-v2",
  "tags": ["AIå¯¼å¸ˆ", "ä¸ªæ€§åŒ–æ¨è", "æ™ºèƒ½æ¨è", "Supabase", "Coze", "v2"]
}